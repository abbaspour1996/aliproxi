#!/bin/bash

# آپدیت سیستم و نصب پیش‌نیازها
sudo apt update -y
sudo apt install -y git python3-pip build-essential libssl-dev zlib1g-dev libbz2-dev libreadline-dev libsqlite3-dev

# نصب pip و کتابخانه‌های پایتون
sudo pip3 install -U pip

# دانلود اسکریپت پروکسی از گیت‌هاب
git clone https://github.com/HirbodBehnam/MTProtoProxyInstaller.git
cd MTProtoProxyInstaller

# نصب وابستگی‌ها از requirements.txt
pip3 install -r requirements.txt

# ساخت secret key رندوم
SECRET=$(head -c 16 /dev/urandom | xxd -p)

# انتخاب پورت رندوم
PORT=$(shuf -i 1024-65535 -n 1)

# ساخت فایل config.py با تنظیمات رندوم
cat <<EOL > config.py
SECRET = "$SECRET"
PORT = $PORT
EOL

# ساخت اسکریپت برای راه‌اندازی پروکسی
cat <<EOL > start_proxy.sh
#!/bin/bash
cd /$(pwd)
python3 mtprotoproxy.py
EOL

chmod +x start_proxy.sh

# راه‌اندازی پروکسی
./start_proxy.sh &
